 
 

## [杨晓凯](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=%E6%9D%A8%E6%99%93%E5%87%AF&code=45683047&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [吴曙智](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=%E5%90%B4%E6%9B%99%E6%99%BA&code=31260754&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [陈晓素](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=%E9%99%88%E6%99%93%E7%B4%A0&code=35724582&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

## [温州市人民医院神经内科](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=in&skey=%E6%B8%A9%E5%B7%9E%E5%B8%82%E4%BA%BA%E6%B0%91%E5%8C%BB%E9%99%A2%E7%A5%9E%E7%BB%8F%E5%86%85%E7%A7%91&code=1694141&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

 

摘    要：

目的 探讨医学影像导出为三维模型并建立交互3D PDF文件。方法 使用了3个开源软件包括3D Slicer、Mesh Lab和Te Xstudio,进行感兴趣区体裁剪、模型分割和3D PDF制作。结果 3D Slicer可以多种方法进行模型分割,Mesh Lab可以进行模型清理和分割,并在导出U3D格式文件的同时生成TEX格式文件,通过Te Xstudio编译生成3D PDF文件。结论 这种方法步骤简单易学,推广普及容易,有利于促进更多3D PDF的制作和使用。

关键词：

[内耳](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E5%86%85%E8%80%B3&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [磁共振成像](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E7%A3%81%E5%85%B1%E6%8C%AF%E6%88%90%E5%83%8F&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [三维](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E4%B8%89%E7%BB%B4&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [重建](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E9%87%8D%E5%BB%BA&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [软件](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E8%BD%AF%E4%BB%B6&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [便携式文档格式](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E4%BE%BF%E6%90%BA%E5%BC%8F%E6%96%87%E6%A1%A3%E6%A0%BC%E5%BC%8F&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

**作者简介：**杨晓凯(1973—),男(汉族),浙江省温州市人,硕士,副主任医师。E-mail:yakeworld@126.comTel:(0577)88053656

**收稿日期：**2016-04-25

**基金：** 温州市科技局基金(Y20140515);

# Medical image segmentation and creation of 3D models for embedding into 3D PDF files

## [YANG Xiao-kai](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=YANG%20Xiao-kai&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [WU Shu-zhi](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=WU%20Shu-zhi&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [CHEN Xiao-su](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=CHEN%20Xiao-su&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

## [Department of Neurology,Wenzhou People's Hospital;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=in&skey=Department%20of%20Neurology%2CWenzhou%20People's%20Hospital&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

Abstract：

Objective To discuss how to convert medical images into a 3D model and embed them in a Portable Document Format( PDF) file. Methods Three opensource programs,3D Slicer,Mesh Lab,Te Xstudio,were used to volume clipping with ROI for segmentation models and embed them in 3D PDF. Results 3D Slicer used a variety of methods for model segmentation,Meshlab carried out model cleaning and segmentationand,generated TEX format files,exported U3 D format files,and then generated 3D PDF files that were compiled by Te Xstudio. Conclusion The method introduced in this paper is simple and easy to learn,and is helpful to promote the production and use of 3D PDF.

Keyword：

[Inner ear;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Inner%20ear&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Magnetic resonance imaging;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Magnetic%20resonance%20imaging&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Three-Dimensional;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Three-Dimensional&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Reconstruction;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Reconstruction&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Software;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Software&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Portable document format;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Portable%20document%20format&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZDcWxWNXlJdTM2dVBiQmMzVT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

**Received：** 2016-04-25

目前临床医疗实践中医学影像三维重建日益增多,但仍多以2D图像表示。便携式文档格式(portable document format,PDF)是Adobe公司开发的用于与应用程序、操作系统、硬件无关的方式进行文件交换的文件格式,可以将文字、字型、格式、颜色及独立于设备和分辨率的图形图像等封装在1个文件中,还可以包含超文本链接、声音和动态影像等电子信息。自2007年开始,1.6版本PDF规范支持将U3D、PRC格式三维(three-dimensiona,3D)模型封装在PDF文件中。PDF文件阅读软件Adobe Reader从8.1版本开始支持显示3D模型,并可以让用户进行各种操作。使用插入Javascript脚本,还可以进行动画演示和交互[^1] 。3D PDF文件可用于临床、教育和科研领域,但医学影像导出为三维模型并建立交互3D PDF文件的过程通常比较复杂且常需要商业软件,使得此技术不能被广泛推广使用[^2] 。我们旨在探讨医学影像导出为三维模型并建立交互3D PDF文件的方法,简化流程并分步详解,以促进此技术的应用。

### 材料和方法

整个过程使用了3个开源跨平台的软件,包括3D Slicer(版本4.5.0-1,64位),Mesh Lab(版本1.3.3,64位),Te Xstudio(版本2.10.8,32位),都有Windows、Mac OSX和Linux版本。从医学影像信息系统(picture archiving and communication systems,PACS)导出原始图像保存为DICOM格式,导入3D Slicer软件后分割感兴趣区导出为STL格式,再使用Mesh Lab软件将之转换为U3D格式,并同时会生成1个LaTex文件,最后用TeXstudio编译生成3D PDF文件。

#### 1.影像资料

MRI三维稳态构成干预序列(3D constructive interference insteady stat,3D-CISS)内耳检查图像:SIEMENS公司1.5T超导型磁共振系统。扫描参数:TR 6.0ms,TE 2.7ms,FOV 135X180,矩阵(matrix)256X192,层厚0.7mm,导出图片为DICOM格式。磁共振显微成像(MRI microscopy,MRM)颞骨影像数据由杜克大学活体显微镜中心提供,成人尸体颞骨9.5T磁场下3D快速自旋回波扫描,扫描参数为TR/TE 100ms/6.5 ms;FOV 40mm×40mm×40mm;matrix 512×512×512;带宽(Bandwidth,B/W)62.5 k Hz;分辨率78μm,导出图片为TIFF格式,转换成Analyze格式。

#### 2.制作三维模型

3D Slicer优化的分割步骤为先体裁剪再进行分割。

2.1体裁剪:先用Volume Rendering模块体绘制显示感兴趣区(ROI)(图1A),然后使用volume clip with ROI模块进行体裁剪(volume clipping),可以减少分割运算量和时间。

2.2分割模型:如果体裁剪后感兴趣区和周围组织分开独立,使用Gray Scale Model Maker即可生成表面模型;如果和周围组织连接且界限不清,需要使用各种半自动分割模块包括Grow Cut Effect、EMSegmenter、Simple Region Growing Segmentation、Robust Statistics Segmenter、Watershed Annotation和Segmentation Plugin(WASP)等模块进行分割后三维重建,必要时可以用Editor模块进行手动分割。

#### 3.清理三维模型和转换格式

导出的三维模型通常会包括一些杂乱孤立的碎片,常需要进行清理。Mesh Lab软件REmovve Isolated Pieces(wrt Diameter)模块可以清理碎片,Split in Connected Components模块可以将模型根据是否连接分成不同部分,在导出U3D格式文件的同时,会同时生成一个TEX格式文件,可以用来编译生成3D PDF文件。

#### 4.生成3D PDF

Meshlab自动生成的TEX格式文件用Te Xstudio即可编译生成3D PDF文件。

### 结果

用3D Slicer软件进行医学图像分割和模型导出操作比较方便,对16例1.5T MRI 3D-CISS序列内耳检查图像分割前庭模型每只平均需约5min。而以Mesh Lab清理三维模型和转换格式和Te Xstudio编译TEX文件均只要片刻时间。生成的嵌入前庭三维模型的PDF文件只有约34kb,可以用Adobe Reader软件打开(图1B)。以磁共振显微成像颞骨影像数据体绘制内耳(图1C),由于和周围组织分界不清,需要使用半自动分割模块如WASP模块分割内耳,生成的3D PDF显示模型则更加精细(图1D)。

![](https://upload-images.jianshu.io/upload_images/10716757-963abbd31cde507e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

图1 内耳体绘制和3D PDF显示Fig.1 3 visualization of inner ear by volume rendering and 3D PDF  

A,B为MRI 3D-CISS序列内耳检查,C,D为MRM颞骨扫描,A,C为体绘制,B,D为3D PDF显示A,B are inner ear MRI scanning with 3D-CISS sequence;C,D are Temporal bone MRM scanning;A,C are volume rendering;B,Dare surface rendering in 3D PDF

### 讨论

我们介绍了从医学图像分割导出三维模型并嵌入PDF。分割制作三维模型有多种软件可以使用,常需使用商业软件。3D Slicer是免费开源的医学图像处理平台,广泛用于多种临床研究,支持多种格式医学图像的导入,有多个模块支持模型分割,其模块Editor上手容易,使用ROI体裁剪后可以快速生成表面模型,复杂模型还可以使用各种半自动分割模块。Mesh Lab是开源的功能强大的网格处理系统,可以显示、编辑、清理3D三角形网格,也是第1个支持U3D格式转换的开源软件。MeshLab不但可以轻松完成模型清理任务,还可以把模型转换成嵌入PDF所必需的U3D格式,而且同时生成可以转换为3D PDF文件的TEX文件。此外,Mesh Lab还有很多其他功能,比如Split in connected components功能可将三维模型非连接的结构自动分割成部件,在分析三维模型时非常有用[^3] 。虽然商业软件Adobe Acrobat原生支持制作3 D PDF,但用LaTex产生3D PDF更加简便,且通过改写TEX文件,还可以加入按钮,脚本、声音等其他要素以及Javascript脚本。TeXstudio是LaTex的集成开发环境,功能齐全,在编译LaTex文件时会自动从网络下载相关模块,使用简单。Adobe Reader打开3D PDF文件,可以跟三维模型进行多种方式的交互,包括放大缩小,旋转,改变光源、背景、颜色等。3D PDF中嵌入的3D模型也可以提取用于3D打印等其他研究目的,所以很多杂志也推荐使用3D PDF论文以有利于学术交流。虽然有不同的软件可以用于3D PDF的制作[^1][^4][^5][^6][^7]。但本研究所用软件均为开源软件,具有免费、跨平台、可网络获取等优点,且支持扩展插件,可改写源代码,所介绍方法步骤简单易学,推广普及容易,有利于促进更多3D PDF的制作和使用,对临床和科研教学都有帮助[^8][^9] 。

### 参考文献
[^1]: Prats-Galino A,Reina MA,Mavar Haramija M,et al.3Dinteractive model of lumbar spinal structures of anesthetic interest[J].Clin Anat,2015,28(2):205-212.

[^2]: Newe A.Towards an easier creation of three-dimensional data for embedding into scholarly 3D PDF(Portable Document Format)files[J].Peer J,2015,3:e794.

[^3]: Shin DS,Chung MS,Park JS,et al.Portable document format file showing the surface models of cadaver whole body[J].J Korean Med Sci,2012,27(8):849-856.

[^4]: Ruthensteiner B,Hess M.Embedding 3D models of biological specimens in PDF publications[J].Microsc Res Tech,2008,71(11):778-786.

[^5]: Kumar P,Ziegler A,Grahn A,et al.Leaving the structural ivory tower,assisted by interactive 3D PDF[J].Trends Biochem Sci,2010,35(8):419-422.

[^6]: Phelps A,Naeger DM,Marcovici P.Embedding 3D radiology models in portable document format[J].AJR Am J Roentgenol,2012,199(6):1342-1344.

[^7]: Newe A,Ganslandt T.Simplified generation of biomedical 3Dsurface model data for embedding into 3D portable document format(PDF)files for publication and education[J].PLoS One,2013,8(11):e79004.

[^8]: Yang XK,Zheng YY,WU SX.Study of BPPV precise manipulation treatment[J].Journal of Clinical Otorhinolaryngology Head and Neck Surgery,2016,30(8):623-626.(in Chinese)杨晓凯,郑炎焱,吴森翔.良性阵发性位置性眩晕精准手法复位探讨[J].临床耳鼻咽喉头颈外科杂志,2016,30(8):623-626.

[^9]: Yang XK,Zheng YY,Wu Sh Zh,et al.Measurements of semicircular canal space direction based on 3D modeling of MRIdata and clinical application[J].Acta Anatomica Sinica,2016,47(2):238-242.(in Chinese)杨晓凯,郑炎焱,吴曙智,等.基于磁共振数据的三维半规管建模空间方向测量[J].解剖学报,2016,47(2):238-242.
