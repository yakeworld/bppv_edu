 

杨海清， 何力， 田聪聪， 袁刚， 刘兆邦， 杨晓凯
|||
|--|--|
| 【作者机构】 | [浙江工业大学信息工程学院](http://qikan.chaoxing.com/jourcompany?compyids=265082)； 中国科学院苏州生物医学工程技术研究所医学影像室； 温州市人民医院神经内科 |
| 【来    源】 | [《传感器与微系统》](http://qikan.chaoxing.com/mag/infos?mags=ea15bb11cfca2424f0d7bb9279488c4f) 2019年第7期 P82-85页 |
| 【分 类 号】 | R318.6;\|TP391.41 |
| 【分类导航】 | [医药、卫生](http://qikan.chaoxing.com/s?sw=classfy(R)&size=20)->[基础医学](http://qikan.chaoxing.com/s?sw=classfy(R3)&size=20)->[医用一般科学](http://qikan.chaoxing.com/s?sw=classfy(R31)&size=20)->[生物医学工程](http://qikan.chaoxing.com/s?sw=classfy(R318)&size=20) |
| 【关 键 词】 | [良性阵发性位置性眩晕(BPPV)](http://qikan.chaoxing.com/jourkeyword?sw=%E8%89%AF%E6%80%A7%E9%98%B5%E5%8F%91%E6%80%A7%E4%BD%8D%E7%BD%AE%E6%80%A7%E7%9C%A9%E6%99%95%28BPPV%29) [红外成像](http://qikan.chaoxing.com/jourkeyword?sw=%E7%BA%A2%E5%A4%96%E6%88%90%E5%83%8F) [H.265编码](http://qikan.chaoxing.com/jourkeyword?sw=H.265%E7%BC%96%E7%A0%81) [^5](http://qikan.chaoxing.com/jourkeyword?sw=5) [GHz](http://qikan.chaoxing.com/jourkeyword?sw=GHz) [WiFi](http://qikan.chaoxing.com/jourkeyword?sw=WiFi) [眼震追踪](http://qikan.chaoxing.com/jourkeyword?sw=%E7%9C%BC%E9%9C%87%E8%BF%BD%E8%B8%AA) |
| 【基    金】 | 温州市科技计划资助项目(ZS2017020，S20170011，Y20170103) |
| 【摘    要】 | 针对良性阵发性位置性眩晕(BPPV)诊断中视频眼震记录仪存在的分辨率低、帧率低、抗干扰能力不足的问题,提出了一种实时的无线高速视频眼震追踪系统。基于ARM Cortex-A7构架和最新5 G WiFi模块设计了高速无线传输的核心控制板,使用MIPI相机接口保证了视频的高速采集,采用H. 265高性能编码技术实现视频的无损压缩,通过RTSP实时网络传输协议完成无线传输网络构建,终端通过无线网络接收眼震视频,进行基于暗瞳的实时眼震追踪算法分析获取眼震信息。在视频分辨率、帧率对系统精度的影响与不同传输方式的抗干扰能力,实验结果表明:提出的高速视频眼震分析系统精度高、抗干扰能力强,能准确获取眼震轨迹,为疾病的诊断奠定了基础。
[pdf下载](http://qikan.chaoxing.com/goread?aid=7209&dxid=100268639754&pkey=0&datatype=1&sid=43&ssid=&d=7f54d8e8477694808fa8ab0838260de30e28549453ffc90f6ff5487c59260134e8e21d61b9938a007cc4c604baa8308d3f699cbc6856caa863e4a732f6a1cdcca565eafbc1fc4f8b12234821bcf64052&sort=0&isjx=&magid=320910018311&date=2019&title=&sqnum=&apistrclassfy=0_16_6,0_18_17&flid=161) 

# 一种实时的无线高速视频眼震追踪系统

杨海清1, 何 力1, 田聪聪2, 袁 刚2, 刘兆邦2, 杨晓凯3

(1.浙江工业大学 信息工程学院，浙江 杭州 310023；2.中国科学院 苏州生物医学工程技术研究所 医学影像室，江苏 苏州 215000；3.温州市人民医院 神经内科，浙江 温州 325000)

摘 要: 针对良性阵发性位置性眩晕(BPPV)诊断中视频眼震记录仪存在的分辨率低、帧率低、抗干扰能力不足的问题，提出了一种实时的无线高速视频眼震追踪系统。基于ARM Cortex-A7构架和最新5 G WiFi模块设计了高速无线传输的核心控制板，使用MIPI相机接口保证了视频的高速采集，采用H.265高性能编码技术实现视频的无损压缩，通过RTSP实时网络传输协议完成无线传输网络构建，终端通过无线网络接收眼震视频，进行基于暗瞳的实时眼震追踪算法分析获取眼震信息。在视频分辨率、帧率对系统精度的影响与不同传输方式的抗干扰能力,实验结果表明:提出的高速视频眼震分析系统精度高、抗干扰能力强，能准确获取眼震轨迹，为疾病的诊断奠定了基础。

关键词： 良性阵发性位置性眩晕(BPPV)； 红外成像； H.265编码； 5 GHz WiFi； 眼震追踪

# A real-time wireless high-speed video-nystagmography tracking system*

YANG Haiqing1, HE Li1, TIAN Congcong2, YUAN Gang2, LIU Zhaobang2, YANG Xiaokai3

(1.Zhejiang University of Technology,School of Information Engineering,Hangzhou 310023,China;2.Chinese Academy of Sciences, Suzhou Institute of Biomedical Engineering and Technology,Medical Imaging Room,Suzhou 21500,China; 3.Neurology Department,Wenzhou People’s Hospital,Wenzhou 325000,China)

Abstract: Aiming at the problem of low resolution,low frame rate,and lack of anti-jamming capability of video-nystagmography in benign positional parsmal vertigo(BPPV) diagnosis,a real-time wireless high-speed video-nystagmography tracking system is proposed.The system constructs the core control board which can realize high-speed wireless transmission based on ARM Cortex-A7 architecture and 5G WiFi module,use MIPI camera interface to ensure high-speed video acquisition,using H.265 high-performance coding technology to achieve video lossless compression,completing the construction of the wireless transmission network through the real-time RTSP network transmission protocol,the terminal receives the nystagmus video through the wireless network,and performs the real-time nystagmus tracking algorithm analysis based on the dark pupil to acquire the nystagmus information.The effect of video resolution and frame rate on system precision and anti-jamming ability of different transmission modes are tested.The experimental results show that the proposed high-speed video-nystagmography tracking system has high precision and strong anti-interference ability,and can accurately obtain nystagmus trajectory,which lay the foundation for the diagnosis of the disease.

Keywords: benign positional paroxysmal vertigo(BPPV); infrared imaging; H.265 code; 5 GHz WiFi; nystagmus tracking

DOI:10.13873/J.1000—9787(2019)07—0082—04

收稿日期：2018—06—26

*基金项目：温州市科技计划资助项目(ZS2017020，S20170011，Y20170103)

中图分类号： TP 391

文献标识码：A

文章编号：1000—9787(2019)07—0082—04

作者简介:

杨海清(1971-)，男，副教授，主要研究领域为机器视觉。

刘兆邦(1986-)，男，通讯作者，副研究员，主要研究图像处理，E—mail:liuzb@sibet.ac.cn。


## 0 引 言

良性阵发性位置性眩晕(benign positional paroxysmal vertigo，BPPV)的常用诊断方法为Hallpike变位性眼震试验，诊断的关键在于根据变位试验所诱发的具有典型特征的眼震来进行定侧、定位[^2]。眼震是眼球震颤的简称，是眼球的一种不随意的节律性的往返运动[^3]，眼震在临床中是检查疾病的一种重要依据。国外利用红外视频来对眼震追踪的文章不多见，但以研究出一些视频眼震记录仪产品用于医院的临床中，这些进口设备大多价格昂贵，不利于推广[^4]。国内近几年来也研制出了几款视频眼震记录仪并已在医院临床中使用，但仍存在不少问题，需要进一步完善，医院现有的视频眼震记录仪多为有线传输，其空间旋转性较差，由于在诱发眼震时需要进行变位性实验，在治疗时也需要使用特殊的手法进行复位，使用有线不利于诊断与治疗；医院现有的无线眼震记录仪视频采集分辨率及帧率较低，导致精度不足，对微弱眼震的记录存在缺失。

本文设计了一种无线高速视频眼震分析系统，实现了实时眼震的记录与识别，解决了现有的有线视频眼震记录仪空间旋转性差、无线视频眼震记录仪分辨率及帧率低的问题。

## 1 眼震记录仪设计

### 1.1 眼震记录仪结构总体设计

眼震记录仪设计为穿戴式眼罩，其中一个眼罩包括摄像头和光路模块，另一个包括核心控制板和无线传输模块[^5]，总体结构组成如图1所示。

![](https://upload-images.jianshu.io/upload_images/10716757-3c251b2c59409be4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=86,dpi=110")

图1 总体结构

### 1.2 光路设计

为了适应于眼震追踪算法，设计了独特的采集模块，只采集眼部区域视频，避免背景的干扰；采用暗瞳成像原理使采集的瞳孔区域易于区分，便于算法处理；采用红外光源照明，通过二向色镜滤除掉可见光的干扰，保证了采集的图像光照均匀并且不受环境光照的影响，有利于算法相关参数的选取[^6]。

由4个红外光源产生近红外光，通过二向色镜的反射照射到眼部，镜头接收眼球通过二向色镜反射回来的红外光，进而完成眼部图像的采集。眼震记录仪设计为穿戴式眼罩，眼罩的结构如图2所示，二向色镜与摄像头红外光源分别位于眼罩两端，其距离b为5 cm，二向色镜与眼睛的距离a为3 cm，红外光源的入射光线与眼睛的反射光线和二向色镜的夹角均为45°。红外光源的波长为850 nm近红外波段，功率为50 mW，二向色镜的透射波长为400～700 nm，反射波长为800～950 nm。

![](https://upload-images.jianshu.io/upload_images/10716757-98646046112042d0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=151,dpi=110")

图2 眼罩结构

### 1.3 核心控制板

核心控制板是基于Cortex-A7内核，主频最高可以达到600 MHz，还具有32 KB 的指令缓存和数据缓存和128 KB的二级缓存，保证了高速眼震视频的输入与处理能力，其内部集成了H.264/H.265/MJPEG/JPEG等多协议编解码器，能快速有效实现眼震视频的无损压缩。

本系统采用的是高性能400万像素OV4689传感器，其采用先进的2 μmOmniBSI-2TM像素，提供同类最佳的低光敏度和高动态范围，OV4689可以每秒60帧捕获HD(高清)1080视频，可实现高速眼震视频的捕捉。使用移动工业处理器接口(mobile industry processor interface，MIPI)，解决了图像传感器与核心控制板之间高速通信的难题，在接口电路中，把数据信号组和控制信号组分别接入核心控制板的MIPI0和SPI0即可。

系统采用RTL8821au无线模块，其采用新一代802.11.ac标准，支持5 GHz频段，相比于802.11.n标准2.4 G频段，具有传输速率快，抗干扰能力强等优势[^7]。该模块通过核心控制板上设计的USB接口电路实现数据的传输[^8]。

## 2 眼震记录仪系统软件框架

眼震记录仪的软件框架包括眼震记录仪端与PC端软件两部分，两者一起实现了眼震视频的采集、压缩编码、无线传输和算法分析等功能。如图3所示为眼震追踪系统软件框架。

![](https://upload-images.jianshu.io/upload_images/10716757-c92256e62b32edf6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=237,dpi=110")

图3 眼震追踪系统软件框架

主要包括功能：

1)基于ISP的视频采集模块：实现相机传感器的适配，设定采集图像的公共属性，包括帧率、分辨率，并对采集的图像进行坏点检测、去噪等处理；

2)Video subsystem硬件编码模块：将采集到的YUV格式的视频送入编码模块，接着对视频进行H.265格式编码；

3)基于RTSP协议的实时视频传输模块：该模块分为Linux服务端与Windows客户端两部分，Linux端先通过RTSP协议负责与Windows端沟通传输方式与内容，本系统使用的是H.265流、后续的RTP,RTCP协议采用的是UDP传输、RTSP服务器的端口号为554，接着将Video subsystem编码后的视频通过打包到RTP协议的数据部分发送到Windows客户端，最后通过RTCP协议中断整个协议的传输；

4)控制通信模块：眼震记录仪与PC端使用Socket通信方式PC端将控制指令与配置信息打包并转化为流数据，再通过无线网络传输到下位机， Cortex-A7处理器根据事先规定好的协议解析数据包，并做出响应并返回给上位机响应信息；

5)基于FFmpeg的视频解码模块：调用FFmpeg库中的函数，将通过RTSP协议接收到的H.265视频流解码为算法模块能使用的视频流；

6)基于暗瞳的眼震追踪算法模块：对接收到的眼震视频进行算法分析，提取瞳孔中心坐标，根据坐标变化判断眼震轨迹。

## 3 PC端实时眼震追踪算法

在BPPV的诊断中，医生需要实时观察患者的眼震轨迹，对算法的运行速度有很高的要求，眼震追踪算法的关键在于瞳孔中心坐标的获取，国内外文献中应用于眼动追踪中的瞳孔定位算法方法比较多，其中比较典型的有阈值法、星爆模型、Hough变换圆检测等[^9][^10][^11]，但是其中的大部分算法处理一帧图像的时间较长，不是很适用于本系统。本系统设计为满足每秒60帧视频的实时瞳孔追踪，这样处理一帧图像的时间需为16 ms，算上接收与解码的时间的话，处理一帧的时间更要小于16 ms。

为解决实时眼震追踪，本文在采集端做了独特的设计，采集到了只有眼部区域的高质量不受环境光照影响的暗瞳眼震视频，这样避免了瞳孔追踪中为消除这些影响而做的处理，并通过Harr特征与积分图来提取瞳孔附件为感兴趣区域，减小了后续算法处理的区域从而缩短了处理时间，算法通过VS与OpenCV实现，在算法处理的过程中需要多次遍历图像，为了提高效率，利用VS中的OpenMp进行并行编程，加快遍历操作。

本文的算法流程如图4所示，先提取感兴趣区域，接着对其进行图像预处理，再进行瞳孔中心定位，根据获得的瞳孔中心坐标生成眼震曲线图。

![](https://upload-images.jianshu.io/upload_images/10716757-dada79e77348c053.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=86,dpi=110")

图4 眼震追踪算法流程

### 3.1 提取感兴趣区域

Haar特征是反映图像灰度变化的，像素分模块求差值的一种特征，在特征模板内用黑色矩形像素和减去白色矩形像素和来表示这个模版的特征值。瞳孔附件的区域可以很容易的通过这种特征描述，采集的眼部图像如图5(a)由于采集的是暗瞳图像，瞳孔为黑色，其四周为白色区域，感兴趣区域可以通过如图5(b)特征模板表示，求得图像中该模板特征值最大的位置即为所需的瞳孔附近感兴趣区域，如图5(c)所示。

![](https://upload-images.jianshu.io/upload_images/10716757-b21587685ea0ae1b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=108,dpi=110")

图5 提取感兴趣区域

### 3.2 图像预处理与边缘检测

眼震记录仪采集图像时使用了四个红外光源照明，这会在图像上形成四个普尔钦斑，影响后面瞳孔中心定位算法的速度与精度，为消除光斑的影响先对感兴趣区域进行形态学处理，包括腐蚀与膨胀操作，同时形态学处理能消除一部分睫毛对瞳孔中心定位的影响。

如图6(c)为经过形态学处理和高斯滤波后再进行Canny边缘检测的效果，可以看到，相比图6(a)和图6(b),图6(c)瞳孔的边缘变得平滑，断开的部分也变少，同时也消除了大部分光斑和睫毛的影响。

![](https://upload-images.jianshu.io/upload_images/10716757-1eec5f156bb58d7e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=129,dpi=110")

图6 图像预处理与边缘检测

### 3.3 瞳孔中心定位

获取瞳孔中心坐标的常见方法有星爆模型和Hough变换圆检测，其中星爆模型准确度比较低，Hough变换圆检测耗时长，都不是很满足要求。在瞳孔中心定位时，本文使用了基于最小二乘技术的椭圆拟合方法来获取瞳孔中心坐标[^12]，相较于前两种方法，准确性和实时性都能满足要求。

椭圆可以由以下二阶多项式圆锥曲线表示

![](https://upload-images.jianshu.io/upload_images/10716757-30de10d4c81ae5f5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=236,height=17,dpi=110")

上式具有特殊的椭圆约束条件b2-4ac<0

式中![](https://upload-images.jianshu.io/upload_images/10716757-06a9bbe97d801af3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=281,height=17,dpi=110")

为输入点的坐标，多项式![](https://upload-images.jianshu.io/upload_images/10716757-5a45710c3b360ad4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=46,height=17,dpi=110")

为点(x,y)到椭圆![](https://upload-images.jianshu.io/upload_images/10716757-f117679bb78ac113.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=52,height=14,dpi=110")

0的代数距离。最小二乘法主要是用来寻找中系数的值，从而使Canny边缘检测获得的数据点与拟合椭圆之间的代数距离最小化，对Canny边缘检测获得的点进行最小二乘处理，也即通过使![](https://upload-images.jianshu.io/upload_images/10716757-9d2689e3bfab5e60.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=117,height=35,dpi=110")

的值最小来确定![](https://upload-images.jianshu.io/upload_images/10716757-8fe3d6eb83ae02b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=8,height=14,dpi=110")

中系数的值。确定了![](https://upload-images.jianshu.io/upload_images/10716757-cca0d8a2fad8d70b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=8,height=14,dpi=110")

中的系数后也就确定了椭圆的方程与椭圆中心的坐标，算法效果如图7所示。

![](https://upload-images.jianshu.io/upload_images/10716757-16654e03f13f7aa5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=108,dpi=110")

图7 瞳孔中心坐标

将计算出的每帧图像瞳孔中心的坐标生成眼震曲线，医生通过该曲线来判断出眼震类型从而诊断疾病。经计算本文的眼震追踪算法流程处理一帧图像的时间为13 ms，满足了60帧每秒实时眼震追踪。

## 4 实验结果与分析

### 4.1 传输稳定性

测试传输性能时眼震记录仪采集视频数据，进行H.265压缩编码，再通过RTSP服务器以不同的传输方式将编码后的视频传输到PC客户端，PC端使用VLC播放器解码显示，传输方式使用实验室有线局域网、802.11.n标准2.4G频段WiFi和802.11.ac标准5G频段WiFi。

本文模拟了BPPV诊疗中眼震记录仪的工作状态，测试了不同传输方式在眼震记录仪静止、运动和电磁干扰这三种情况下传输的稳定性，结果如表1所示。采集的视频分辨率为HD720，帧率为60。测试时电脑不连接因特网，也不使用其他占用网络的软件，传输HD720/60帧需要的带宽小于这三种传输方式的极限带宽。采集传输6 000帧视频，统计期间的丢帧数，并计算出丢帧率作为稳定性的衡量标准。

表1 传输稳定性

![](https://upload-images.jianshu.io/upload_images/10716757-84506b7e4e4b4103.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=346,height=111,dpi=110")

由表1实验结果可知，在静止条件下三种传输方式丢帧率都很低，在运动与抗干扰性方面5 G频段WiFi接近于有线网络传输，并都强于2.4 GHz频段WiFi。

### 4.2 系统精度

根据国际注视交流交互技术委员会(The COGAIN Technical Comittee)在2012年提出的眼动仪系统精度测量的标准技术方法，本文眼震记录仪系统精度以相邻样本间瞳孔中心角距离的均方根值(root mean square,RMS)[^13]

![](https://upload-images.jianshu.io/upload_images/10716757-f3ff87213f76619d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "width=217,height=41,dpi=110")
(1)

实际测量中系统精度受多种因素影响，包括红外光源照明强度、室内照明度改变、人眼特征等，本文只讨论采集视频帧率与分辨率对系统精度的影响，实验过程中保持其他环境不变，采集存储一段时间60帧/s的HD1080视频，将视频改变帧率与分辨率，再分别使用PC端算法对不同帧率与分辨率的视频进行瞳孔追踪，根据获取的相邻两帧图像的瞳孔中心坐标计算出RMS的值，实验结果:HD1080/60,HD1080/30,VGA/60,VGA/30分别为0.005,0.013,0.023,0.069。单位为度，数值越小表示系统精度越高[^14]。

由上面数据可知，帧率相同时分辨率越高系统的精度越高，分辨率相同时帧率越高系统的精度越高，而帧率分辨率都高时系统精度最高。

## 5 结 论

实验结果表明：5 GHz WiFi的使用提高了眼震记录仪的抗干扰能力，高清及高帧率眼震视频的获取，提高了系统的精度。本文设计出的视频眼震分析系统稳定精度高，能够实时有效的获取眼震的运动轨迹，为BPPV的诊疗提供了信息支持。

参考文献:

[^1]:  张波,孙敬武.良性阵发性位置性眩晕患者裸眼及视频眼震图下眼震特征及定位诊断分析[J].听力学及言语疾病杂志,2012,20(3):235-237.

[^2]:  VON BREVERN M,BERTHOLOR P,BRANDT T,等.良性阵发性位置性眩晕诊断标准[J].中国全科医学,2017,20(11):1275-1281.

[^3]:  王长元,史学颖.基于视频眼震图的瞳孔中心定位方法研究[J].计算机与数字工程,2011,39(3):128-130.

[^4]:  王锦榕.眼动跟踪系统设计与实现[D].大连：大连理工大学,2011.

[^5]:  刘紫燕,冯亮,祁佳.一种基于FPGA的实时视频跟踪系统硬件平台设计[J].传感器与微系统,2014,33(7):98-102.

[^6]:  周建萍,刘洪英,皮喜田,等.基于WiFi技术的便携式耳鼻喉内视镜系统设计[J].传感器与微系统,2018，37(1):99-101.

[^7]:  潘银松,张威,张文普,等.基于USB 2.0的X射线图像传感器数据采集系统[J].传感器与微系统,2009,28(3):92-94.

[^8]:  郭政.5 G WiFi标准——802.11ac解析及应用展望[J].科技传播,2012,4(15):217-218.

[^9]:  陈学军,杨永明,何为.红外眼震视频瞳孔寻迹[J].生物医学工程学杂志,2012,29(2):347-351.

[^10]:  WU J H,OU W L,FAN C P.NIR-based gaze tracking with fast pupil ellipse fitting for real-time wearable eye trackers[C]∥2017 IEEE Conference on Dependable and Secure Computing, IEEE,2017:93-97.

[^11]:  ZHAO Y,QU Z,HAN H,et al.An effective and rapid localization algorithm of pupil center based on Starburst model[C]∥Advanced Information Management,Communicates,Electronic and Automation Control Conference，IEEE,2017:988-991.

[^12]:  FITZGIBBON A W,PILU M,FISHER R B.Direct least squares fitting of ellipses[C]∥International Conference on Pattern Recog-nition,IEEE,2002:253-257.

[^13]:  HOLMQVIST K,NYSTRÖM M,MULVEY F.Eye tracker data quality: What it is and how to measure it[C]∥Symposium on Eye Tracking Research and Applications,ACM,2012:45-52.

[^14]:  张李娜,史学锋,赵堪兴.视频眼动仪系统测量的精确度及不同红外照明强度的影响[J].中华实验眼科杂志,2015,33(12):1118-1121.


