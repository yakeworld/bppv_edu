

## [蔡文洁](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=%E8%94%A1%E6%96%87%E6%B4%81&code=46437287&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [郑炎焱](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=%E9%83%91%E7%82%8E%E7%84%B1&code=31581369&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [杨晓凯](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=%E6%9D%A8%E6%99%93%E5%87%AF&code=28949935&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

## [温州市人民医院](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=in&skey=%E6%B8%A9%E5%B7%9E%E5%B8%82%E4%BA%BA%E6%B0%91%E5%8C%BB%E9%99%A2&code=1694141&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

 

摘    要：

目的 使用人工智能算法，设计开发住院培训学员轮转排班辅助系统。方法 基于python科学计算模块，采用贪心算法与随机算法，以方差减少作为评价指标，设计、开发住院培训学员轮转排班辅助系统。结果 针对不同情况设定的初始排班表，系统都可以快速取得最优解，以科室轮转人数最多月份和最少月份进行对换的方案为最优。结论 系统不仅可以获得排班最优解，还可以满足复杂的个性化排班需求，适用于所有横向目标前后顺序可以对换的类似排列均衡性问题，有较大的推广应用价值。

关键词：

[医院](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E5%8C%BB%E9%99%A2&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [轮转](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E8%BD%AE%E8%BD%AC&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [排班](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E6%8E%92%E7%8F%AD&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [辅助系统](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E8%BE%85%E5%8A%A9%E7%B3%BB%E7%BB%9F&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [贪心算法](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [随机算法](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

# Design and Development of Rotational Scheduling Assistant System Based on Greedy Algorithm and Stochastic Algorithm

## [CAI Wen-jie](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=CAI%20Wen-jie&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [ZHENG Yan-yan](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=ZHENG%20Yan-yan&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [YANG Xiao-kai](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=au&skey=YANG%20Xiao-kai&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

## [Wenzhou People's Hospital;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=in&skey=Wenzhou%20People's%20Hospital&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

Abstract：

Objective To design and develop a rotation scheduling assistance system using artificial intelligence algorithms. Methods Based on the python scientific calculation module, a greedy algorithm combined with a stochastic algorithm was used, and the variance reduction was used as the evaluation index. Results The initial schedules set for different situations could quickly obtain the optimal solution. The swap scheme that swapped the month with most rotation people for the month with least rotation people was the optimal plan. Conclusion The system can not only obtain the optimal solution for scheduling, but also meet complex personalized requirements. It is applicable to all the situation that the order of all the horizontal targets can be exchanged, which is similar to the permutation balance. It has great promotion and application value.

Keyword：

[Hospital;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Hospital&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Rotation;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Rotation&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Scheduling;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Scheduling&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Assistant system;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Assistant%20system&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Greedy algorithm;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Greedy%20algorithm&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!) [Stochastic algorithm;](http://chkdx.cnki.net/kcms/detail/knetsearch.aspx?dbcode=CHKJ&sfield=kw&skey=Stochastic%20algorithm&code=&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)

住院培训学员轮转排班是根据不同学员轮转要求在合适的时间分配到合适的专业培训科室，其本质类同排课问题，但涉及的因素和目标有所不同[^1]。随着住院培训基地招生规模扩大，学员数量比以往大大增加，基地教学任务增加，学员分配不均衡问题日益突出，既往采用Excel对轮转计划进行手工规划的人工方式很难排出合理的轮转表。排课问题很早以前就成为众多科研人员和软件公司的研究课题，有多种算法的应用能够得到更优的排课方案，但少有应用于医院住院培训学员轮转排班问题 [^2] [^3]。为此，探求合理的算法以设计开发出合理的轮转排班系统很有必要。

### 资料和方法

#### 1.研究对象。

在系统设计阶段，选择某医院内科专业199名学员，根据培训要求随机生成初始住院培训轮转计划及排班表。实践应用阶段，选择温州市人民医院国家住院医师规范化培训基地200名学员的轮转排班作实际系统模拟。

#### 2.研究方法

#### 2.1改进前的住院培训轮转计划。

改进前的住院培训轮转排班表根据学员人数、专业和住院培训计划按照统一格式，使用Excel软件手工生成。id为学员识别号，可以为工号或者身份证号码，列名按照年月或者其他格式，可以用颜色标识特定位置不发生改变以满足基地或者学员的特殊需求，可以设置特定月份轮空如请假(见表1)。

#### 2.2改进后的住院培训轮转计划。

改进前的住院培训轮转排班表难以解决人员分布不匀问题。采用人工智能算法，对原排班表进行处理，用红色标识的特殊安排如id1学员根据需求在2019年9月和10月安排消化内科，id2学员在2019年9月安排在感染科、2019年10月安排在ICU,id3学员在2019年12月安排在急诊科，以及id2学员在2019年12月请假没有安排科室设置为空值，这些设定始终保持原来位置，只有其他项目可以横向对调(见表2)。

表1 改进前的住院培训学员轮转排班表    [](https://xrd.cnki.net/KXReader/Detail/GetImg?filename=images/GWYG202008021_06400.jpg&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)下载原表

 ![](https://upload-images.jianshu.io/upload_images/10716757-26e79944a74b0e09.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


表2 改进后的住院培训轮转排班表    [](https://xrd.cnki.net/KXReader/Detail/GetImg?filename=images/GWYG202008021_06500.jpg&uid=WEEvREcwSlJHSldTTEYzVDhUSFFkZEtZYkZYZnNsNmRzN2NFWXBSQ2Q2UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!)下载原表
![](https://upload-images.jianshu.io/upload_images/10716757-e4105a2437a2e3e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

 

#### 3.调整方法

3.1建立初始排班表PB，根据人员数和轮转计划，计算轮转排班表各个科室(ks)每月平均轮转人数。

![](https://upload-images.jianshu.io/upload_images/10716757-037fbf564b887672.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


3.2新建表PB＿NUM，索引为科室，列名为时间(月份)，值为当月科室轮转人数和科室每月平均轮转人数差值。为方便直观观察科室轮转人员均匀度变化，将表格数字视为图像的像素值，可以以图像的形式显示程序运行过程科室轮转人员均匀度的变化。

![](https://upload-images.jianshu.io/upload_images/10716757-28510ac8e3b998a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


3.3表PB＿NUM，取科室索引最高值和最低值所对应月份，将PB表上相应最高值月份科室和最低值月份进行对调，同时PB＿NUM表数值相应改变。如何取值有多种方案，各有利弊，主要是需要避免陷入局部最优解和优化计算时间。比较合理的方案为在各科室最多人员月份，随机抽取超出人员和最小人数月份基地进行对调。其他方案包括取PB＿NUM全局最多人数对应位置，计算与之对调后方差减少最大位置进行对调，其主要缺点是计算量大，对象选择范围小，容易陷入死循环。

3.4对调原则。计算调整前后的人员方差。如果调整后方差下降一律执行对调，否则，根据设定的概率接收对调。如果轮转排班表中特定位置有红色等标识或者空值，不执行对调。

#### 4.评估方法

#### 4.1方差下降数。

均匀度是表示点集在空间中分布均匀性的一个参数,通常使用方差来标识。对于住院培训轮转排班表的人员分布问题均匀度问题，可以看作是一个二维空间的点集均匀度问题，利用方差来表示其均匀度系数α的方法如下：

![](https://upload-images.jianshu.io/upload_images/10716757-e916dc4c93965e3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


其中，n是轮转科室的总数量，m是轮转时间段的总数量，L<sub>ij</sub>是第i个轮转科室第j个时间段的轮转人员数，L<sub>i</sub>是第i个科室所有时间段轮转学员的平均值(保留整数部分)。均匀系数度越小，其均匀度越好。

改进前的住院培训轮转计划方差和改进后的住院培训轮转计划方差进行对照。方差等于各个数据与其算术平均数的离差平方和的平均数，可以描述随机变量对于数学期望的偏离程度。

#### 4.2判断是否为最佳住院培训轮转计划。

对于第i个科室，如果每一个月份L<sub>ij</sub>和L<sub>i</sub>的差均不超过1，其方差达到最小值。所有科室方差达到最小值，可以认为每月科室人员数达到最优分布。是否为最佳住院培训轮转计划的判断标准为科室每月轮转人员变动数目不超过1个。

#### 5.辅助排班系统开发。

python语言是最受欢迎的程序设计语言之一，具备简洁性、易读性以及可扩展性，其科学计算扩展库可以满足程序开发。系统主要应用模块包括numpy,pandas,random,openpyxl,tkinter,pillow等。其中numpy是python中科学计算的核心库，提供了高性能多维数组对象和用于处理这些数组的工具。Pandas是python的一个是基于num Py数据分析包，是为了解决数据分析任务而创建的，提供了大量能使我们快速便捷地处理数据的函数和方法。random模块用于生成随机数，如random.randint(a,b)生成指定范围的随机整数，random.shuffle()对给定集合重排列(洗牌)，random.choice()给定的集合中选择一个字符。openpyx模块可以读取excel文件表内容和格式信息，并写入excel文件。tkinter模块用于界面开发，pillow模块用于图像格式显示。

### 结果

辅助排班系统采用图形格式实时显示科室每月平均轮转人数分布。软件运行界面可以调整计算循环次数，退火概率和图像放大倍数。默认计算循环次数为20000，退火概率为25‰，图像放大倍数为15。初始平均轮转人数分布图像黑白交错不匀，总方差为6004；运行结果总方差为32，交换操作次数1740次，平均轮转人数分布图像为均匀黑色。

改进后的住院培训轮转计划，有效解决了均衡性问题，能够快速找到最优解，与手工排班相比，方差下降明显，提示科室每月轮转人员达到或接近每月平均轮转人数。

对多种不同方法生成的初始住院培训轮转计划进行了测试：随机生成的初始住院培训轮转计划，能够取得最优解；按照轮转计划手工制作的各专业轮转计划同一的初始住院培训轮转计划，能够取得最优解；原先手工调整实际运行的初始住院培训轮转计划，同样可以取得最优解，并可以用于此后的住院培训轮转计划安排。测试了多个对换取值方案，根据PB＿NUM表科室轮转人员最多月份和最少月份进行对换方案为优。

### 讨论

轮转排班问题计算复杂，不仅不同专业的学员需要完成不同的培训计划，必要时还要考虑专业培训科室的需求，人工排班非常繁琐耗时，但又是住院培训管理的一项重要工作。随着住院医师规范化培训管理水平的提高和教学活动的规范，专业培训科室每月学员人数的不均衡问题日益突出，迫切需要通过专业的系统实现合理的轮转计划安排。轮转问题实质上属于调度问题的研究范畴，即将学员根据约束条件安排在特定的时间和基地中，并使结果达到最优[^4]。由于该问题是一个计算复杂性中的NP完全(NP-Complete,NPC)问题，不能用“穷举法”之外的算法找出最佳解，以目前的计算机技术无法实现穷举，只能寻求有效的近似算法。通常的算法包括贪心算法(Greedy Algorithm)、动态规划(dynamic programming)、遗传算法(Genetic Algorithm)、模拟退火算法(Simulated Annealing)、蒙特卡罗模拟法(Monte Carlo Simulation methods)等 [^1] [^5]。 对于排课问题的研究报道较多，有多种算法的应用能够得到更优的排课方案，但是其约束条件和目标同轮转排班有所区别，并不能直接采用。轮转排班系统研究较少，有部分住院医师规范化培训系统集成轮转排班模块，但没有具体介绍其算法原理[^2]。而且各个住院医师规范化培训科室轮转排班的细节实现存在差异，缺乏通用的辅助排班系统。

我们对轮转排班计划进行了分析，认为轮转排班存在以下特性：(1)横向为时间(通常以月为单位)，基地安排，顺序可以调整但相邻相同内容时间段保持连续。(2)纵向为学员列表。(3)单元格内容为轮转基地名称。(4)单元格以颜色标识表示特定需求需要保持固定。(5)可以存在空值(如请假等情况)。(6)每月专业培训科室的轮转人员数保持均衡。转化为数学问题：(1)根据学员和轮转计划，计算专业培训科室平均时间点(每月)轮转人员数。(2)计算时间点纵向各专业培训科室轮转人员数，人员最多月份随机抽取超出数目人员，其最多月份轮转基地和最少月份进行对调。(3)计算调换前后的方差，如果方差减少，就确认对换。如果调整后方差下降一律执行对调，否则，根据设定的概率接收对调。

算法策略以方差计算作为评估指标，采用贪心算法的思路，每一次交换使得总体方差减少，最终接近整体最优解。判断最优解的标准为科室每月最多人数和最少人数差值不超过1。但贪心算法的缺点是可能会收敛于局部最优，实践也证明其不能恒定获取最优解。退火概率为发生随机对换的概率，设置过小，容易陷入局部最优解，无法达到最优解，设置过大，则增加计算量，达到最优解耗时较长。退火概率选择2.5%左右比较合适，以此概率接收方差没有减少的对换，可以跳出局部最优解，从而快速找到全局最优解并自动中止计算。故此，还需要结合随机算法，采用模拟退火算法的思路，以一定概率接收方差不减少的轮转科室对调，实践证明其可以恒定快速获取最优解。

采用Python语言自行研发辅助排班系统，其丰富的模块可以满足数据表的读取分析，数学运算，随机取值等操作，采用贪心算法结合随机算法，最终实现了住院培训轮转排班最优解获取。不仅如此，通过保持表格颜色标识部分和空缺部分不变动，可以满足复杂的个性化需求。通过算法改良，避开了python语言计算较慢问题，能够快速获取排班结果。系统还可以适用于所有横向目标前后顺序可以对换的类似排列均衡性问题，有较大的推广应用价值。

 

### 参考文献

[^1]: 陈磊.高校排课系统的算法研究[J].电脑编程技巧与维护，2014,(10):124-125.

[^2]: 王杰，钱旦敏，娄帅，等.基于大数据的住院医师规范化培训系统设计与实现[J].计算机应用与软件，2018,35(3):61-66,172.

[^3]: 崔妍，王权，王康，等.排课问题的数学模型[J].沈阳工程学院学报(自然科学版)，2016,12(3):276-278,288.

[^4]: 胡俊.基于蒙特卡洛遗传算法的排课问题研究[J].实验技术与管理，2019,36(3):170-174.

[^5]: 马志强.排课系统贪心算法分析[J].计算机产品与流通，2019,(5):106.
